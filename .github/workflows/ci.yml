name: ci

on:
  push:
    branches:
    - main
    - develop
    - development/*
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    container:
      image: dolfinx/dolfinx:stable

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Verify FEniCSx environment
      run: |
        echo "Python: $(python3 --version)"
        python3 -c "import dolfinx; print('dolfinx version:', dolfinx.__version__)"

    - name: Install Z3ST
      run: |
        pip install --upgrade pip
        pip install -e .[dev]
        pip install pytest

    - name: Run non-regression tests
      run: |
        chmod +x ./z3st/cases/non-regression_github.sh
        ./z3st/cases/non-regression_github.sh

    - name: Upload test summary
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: non-regression-summary
        path: |
          non-regression_summary.txt
          tests/non-regression_summary.txt
          */non-regression_summary.txt
